#!/usr/bin/env bash

{{ template "shared_script_utils.bash" . }}

header "üçé Configuring macOS."

# Set fast key repeat rate
# The step values that correspond to the sliders on the GUI are as follow (lower equals faster):
# KeyRepeat: 120, 90, 60, 30, 12, 6, 2
# InitialKeyRepeat: 120, 94, 68, 35, 25, 15
defaults write NSGlobalDomain KeyRepeat -int 2
defaults write NSGlobalDomain InitialKeyRepeat -int 15

# Set Dark theme
defaults write NSGlobalDomain AppleInterfaceStyle -string "Dark"

# Add input sources; use `defaults read com.apple.HIToolbox AppleEnabledInputSources`
# to read system input sources
# TODO: running this multiple times may cause duplicate entries in system input sources
defaults write com.apple.HIToolbox AppleEnabledInputSources -array-add '<dict><key>Bundle ID</key><string>com.apple.inputmethod.TCIM</string><key>InputSourceKind</key><string>Keyboard Input Method</string></dict>'
defaults write com.apple.HIToolbox AppleEnabledInputSources -array-add '<dict><key>Bundle ID</key><string>com.apple.inputmethod.TCIM</string><key>Input Mode</key><string>com.apple.inputmethod.TCIM.Pinyin</string><key>InputSourceKind</key><string>Input Mode</string></dict>'

# Always show scrollbars
defaults write NSGlobalDomain AppleShowScrollBars -string "Always"

# Set trackpad speed
defaults write NSGlobalDomain com.apple.trackpad.scaling -float 1.5

# Show filename extensions by default
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Expanded Save menu
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode2 -bool true

# Expanded Print menu
defaults write NSGlobalDomain PMPrintingExpandedStateForPrint -bool true
defaults write NSGlobalDomain PMPrintingExpandedStateForPrint2 -bool true

# Require password as soon as screensaver or sleep mode starts
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

# Add Traditional Chinese in languages
defaults write -g AppleLanguages -array en-US zh-Hant-US

# Enable tap-to-click
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
defaults -currentHost write NSGlobalDomain com.apple.mouse.tapBehavior -int 1

# Hide recent apps from Dock
defaults write com.apple.dock show-recents -bool false

info "You will have to re-login for new macOS configurations to take effect"
info "You will have to manually configure some settings like night shift"
